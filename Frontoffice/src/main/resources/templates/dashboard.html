<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard - GCVet</title>
    <style>
        * {
            box-sizing: border-box;
            transition: all 0.3s ease;
            font-family: Arial, sans-serif;
        }

        body, html {
            margin: 0;
            height: 100%;
            padding-top: 20px;
            background-color: #f4f4f4;
        }

        header {
            background-color: #0a3968;
            height: 60px;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }


        .header-title {
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .header-links {
            display: flex;
            align-items: center;
        }

        .header-links a {
            background-color: white;
            color: #0a3968;
            padding: 8px 16px;
            margin-left: 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 14px;
            border: none;
        }

        .header-links a:hover {
            background-color: #9acbfa;
        }

        .notification-icon {
            position: relative;
            font-size: 20px;
            cursor: pointer;
            color: white;
        }

        .notification-icon .badge {
            position: absolute;
            top: -6px;
            right: -10px;
            background-color: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
        }

        .container {
            display: flex;
        }

        .sidebar {
            position: fixed;
            top: 60px; /* abaixo do header */
            left: 0;
            background-color: #0a3968;
            width: 220px;
            height: calc(100vh - 60px);
            padding: 30px 20px;
            color: white;
        }


        .sidebar a {
            display: block;
            color: white;
            text-decoration: none;
            margin: 15px 0;
            padding: 10px;
            border-radius: 6px;
        }

        .sidebar a:hover {
            background-color: #9acbfa;
            color: #0a3968;
        }

        .main {
            flex: 1;
            padding: 30px;
            margin-left: 220px; /* igual √† largura da sidebar */
        }


        .main h1 {
            color: #0a3968;
            font-size: 26px;
            margin-bottom: 30px;
        }

        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card-container.top {
            grid-template-columns: repeat(3, 1fr);
        }

        .card {
            background-color: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card.top {
            background-color: #0a3968;
            color: white;
        }

        .card h3 {
            margin-top: 0;
        }

        .card.top h3, .card.top p {
            color: white;
        }

        .card p {
            color: #333;
        }

        .card button {
            margin-top: 10px;
            background-color: #0a3968;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .card button:hover {
            background-color: #0056b3;
        }

        table {
            width: 100%;
            border-collapse: separate; /* usar 'separate' para permitir o radius */
            border-spacing: 0;
            background: white;
            border-radius: 20px;
            overflow: hidden; /* for√ßa o arredondamento real */
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        thead {
            background-color: #0a3968;
            color: white;
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
        }

        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }


        .section-title {
            color: #0a3968;
            margin-top: 60px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<header>
    <div class="header-title">GCVet</div>
    <div class="header-links">
        <div class="notification-icon" title="Notifica√ß√µes">
            üîî
            <div class="badge">2</div>
        </div>
        <a href="/login" onclick="sessionStorage.clear()">Terminar Sess√£o</a>
    </div>
</header>

<div class="container">
    <div class="sidebar">
        <a href="#">Dashboard</a>
        <a href="#">Marcar Consulta</a>
        <a href="#">Meus Animais</a>
        <a href="#">Hist√≥rico</a>
    </div>

    <div class="main">
        <h1 id="welcomeUser">Ol√°!</h1>

        <!-- Linha azul -->
        <div class="card-container top">
            <div class="card top">
                <h3>Pr√≥xima Consulta</h3>
                <p>20 de Junho √†s 15h com Dr. Silva</p>
            </div>
            <div class="card top">
                <h3>Animais Registados</h3>
                <p>3 animais</p>
            </div>
            <div class="card top">
                <h3>√öltima Consulta</h3>
                <p>10 de Junho - Vacina√ß√£o da Luna</p>
            </div>
        </div>

        <!-- Linha branca -->
        <div class="card-container" style="margin-top: 30px;">
            <div class="card">
                <h3>Nova Consulta</h3>
                <p>Precisa agendar uma nova visita?</p>
                <button>Marcar</button>
            </div>
            <div class="card">
                <h3>Calend√°rio</h3>
                <p>Veja o seu hist√≥rico e consultas agendadas.</p>
                <button>Ver Calend√°rio</button>
            </div>
            <div class="card">
                <h3>Vacinas e Documentos</h3>
                <p>Aceda ao hist√≥rico de vacina√ß√£o e ficheiros dos seus animais.</p>
                <button>Ver Registos</button>
            </div>
        </div>

        <!-- Tabela de Animais -->
        <h2 class="section-title">Animais Registados</h2>
        <table>
            <thead>
            <tr>
                <th>Nome</th>
                <th>Esp√©cie</th>
                <th>Ra√ßa</th>
                <th>Idade</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>Luna</td>
                <td>C√£o</td>
                <td>Labrador</td>
                <td>3 anos</td>
            </tr>
            <tr>
                <td>Mia</td>
                <td>Gato</td>
                <td>Siam√™s</td>
                <td>2 anos</td>
            </tr>
            </tbody>
        </table>

        <!-- Tabela de Consultas -->
        <h2 class="section-title">Consultas Futuras</h2>
        <table>
            <thead>
            <tr>
                <th>Data</th>
                <th>Hora</th>
                <th>Animal</th>
                <th>M√©dico</th>
                <th>Tipo</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>20/06/2025</td>
                <td>15:00</td>
                <td>Luna</td>
                <td>Dr. Silva</td>
                <td>Vacina√ß√£o</td>
            </tr>
            <tr>
                <td>23/06/2025</td>
                <td>10:30</td>
                <td>Mia</td>
                <td>Dra. Ferreira</td>
                <td>Check-up</td>
            </tr>
            </tbody>
        </table>

    </div>
</div>

<script>
    const API_URL = "http://localhost:8080"; // <-- Altera se necess√°rio
    const user = JSON.parse(sessionStorage.getItem("utilizador"));

    if (!user) {
        window.location.href = "/login";
    } else {
        document.getElementById("welcomeUser").textContent = "Ol√°, " + user.nome + "!";

        // üîµ Animais Registados
        fetch(`${API_URL}/api/animais/cliente/${user.id}`)
            .then(res => res.json())
            .then(animais => {
                console.log("‚ñ∂ Animais recebidos:", animais);

                document.querySelector(".card.top:nth-of-type(2) p").textContent =
                    `${animais.length} animal${animais.length !== 1 ? 's' : ''}`;

                const tbody = document.querySelector("table:nth-of-type(1) tbody");
                tbody.innerHTML = "";
                animais.forEach(animal => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${animal.nome}</td>
                        <td>${animal.especie}</td>
                        <td>${animal.raca}</td>
                        <td>${animal.idade} anos</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(err => console.warn("‚ö† Erro ao carregar animais:", err));

        // üîµ Pr√≥xima Consulta
        fetch(`${API_URL}/api/consultas/cliente/${user.id}/proxima`)
            .then(res => res.json())
            .then(c => {
                console.log("‚ñ∂ Pr√≥xima consulta recebida:", c);

                const data = c.data ? new Date(c.data).toLocaleDateString("pt-PT") : "Data indefinida";
                const hora = typeof c.hora === 'string'
                    ? c.hora.substring(0, 5)
                    : (c.hora?.hour !== undefined
                        ? `${String(c.hora.hour).padStart(2, '0')}:${String(c.hora.minute).padStart(2, '0')}`
                        : "?");
                const medico = c.veterinarioResponsavel ?? "N/D";

                document.querySelector(".card.top:nth-of-type(1) p").textContent =
                    `${data} √†s ${hora} com ${medico}`;
            })
            .catch(err => {
                console.warn("‚ö† Erro na pr√≥xima consulta:", err);
                document.querySelector(".card.top:nth-of-type(1) p").textContent = "Sem consultas futuras";
            });

        // üîµ √öltima Consulta
        fetch(`${API_URL}/api/consultas/cliente/${user.id}/ultima`)
            .then(res => res.json())
            .then(c => {
                console.log("‚ñ∂ √öltima consulta recebida:", c);

                const data = c.data ? new Date(c.data).toLocaleDateString("pt-PT") : "Data indefinida";
                const motivo = c.motivo ?? "Motivo desconhecido";
                const nomeAnimal = c.nomeAnimal ?? "N/D";

                document.querySelector(".card.top:nth-of-type(3) p").textContent =
                    `${data} - ${motivo} da ${nomeAnimal}`;
            })
            .catch(err => {
                console.warn("‚ö† Erro na √∫ltima consulta:", err);
                document.querySelector(".card.top:nth-of-type(3) p").textContent = "Sem consultas anteriores";
            });

        // üîµ Consultas Futuras (tabela)
        fetch(`${API_URL}/api/consultas/cliente/${user.id}`)
            .then(res => res.json())
            .then(consultas => {
                console.log("‚ñ∂ Consultas recebidas:", consultas);

                const tbody = document.querySelector("table:nth-of-type(2) tbody");
                tbody.innerHTML = "";
                consultas.forEach(c => {
                    const data = c.data ? new Date(c.data).toLocaleDateString("pt-PT") : "‚Äì";
                    const hora = typeof c.hora === 'string'
                        ? c.hora.substring(0, 5)
                        : (c.hora?.hour !== undefined
                            ? `${String(c.hora.hour).padStart(2, '0')}:${String(c.hora.minute).padStart(2, '0')}`
                            : "‚Äì");
                    const nomeAnimal = c.nomeAnimal ?? "‚Äì";
                    const motivo = c.motivo ?? "‚Äì";
                    const medico = c.veterinarioResponsavel ?? "‚Äì";

                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${data}</td>
                        <td>${hora}</td>
                        <td>${nomeAnimal}</td>
                        <td>${medico}</td>
                        <td>${motivo}</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(err => console.warn("‚ö† Erro ao carregar consultas futuras:", err));
    }
</script>


</body>
</html>
